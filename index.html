
<!DOCTYPE HTML >
<html>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">


<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

<link rel="stylesheet/less" type="text/css" href="styles.less" />
<script src="less.js" type="text/javascript"></script>

   <head>
      <title>EyeTracking</title>
      <div id="display_image"> </div>
      <div class="logo" id="logo">
<img src="DECODITIVE.png" id="icon" heigh="200px" width="200px">
</div>
    <div class="pad" id="pad">
<div id="screen1">
<h2 class="container-text">Test eye-tracking</h2>
<h3>Welcome to Decoditive's testing tool!</h3>
<p class="info">
   Before starting the test, please read the terms and privacy policy to understand what it is about and how we protect you. Afterwards, the steps to follow will be:
   
</p>
<p class="info">We will ask you to answer several questions (they will always be delivered anonymously, we will not share your name or email)</p>
<p class="info">Then, you must perform a calibration of your gaze, which simply consists of following a dot that moves across the screen</p>
<p class="info">Finally, we will show you the content that you have to watch and when it finishes, you can just close the browser</p>
<p class="info">
   If you have any questions, do not hesitate to contact us at the following email address: contact@decoditive.com 
</p>
<form>
<p class="info">
   <input type="checkbox" id="check1" required>
   I accept the
   <a href="https://test.decoditive.com/assets/en/TermsConditions.pdf" target="_blank">
      terms and conditions
   </a>
   </p>
   <p class="info">
      <input type="checkbox" id="check2" required>
   I accept the
   <a href="https://test.decoditive.com/assets/en/PrivacyPolicy.pdf" 
   target="_blank">
   privacy policy
   </a>
</p>
<p class="info">
   <input type="checkbox" id="check3" required>
   I will not record or disclose with any third party the material that I will see because it can be confidential
</p>
<button type="button"  class="btn container-button" id="terms" >
   I accept the terms and conditions, and the privacy policy. Let's go for that test!

</button>

</form>
</div>
<div id="screen2">
   <h2 class="container-text">Test eye-tracking</h2>
   <p id="p2">You're going to test the last version of the eye tracker </p>


   <div id="whitespace">
   <p id="p3">Questions</p>
   <div class="wrapper">
<input type="text" name="name" id="initials" class="form__input"
autocomplete="off" required> 
<label for="initials" class="form__label">
Please, write your initials + birth year. Ie: John Doe, born in 1983 - JD 1983*
</label>
</div>
<button class="btn" type="button"  id="next">Next</button>

</div>
</div>
    </div>




 <script src="https://api.gazerecorder.com/GazeCloudAPI.js" ></script>
 <script src="https://app.gazerecorder.com/GazeRecorderAPI.js"></script>
 <script src="https://app.gazerecorder.com/GazePlayer.js"></script>

      <style type="text/css">
         body {
         overflow: hidden;
         }
	        
         @media  screen and (min-width: 1920px) {
  
            #whitespace{
            position: relative;
            padding: 10rem;
            border-radius: 1rem;
            bottom: 16rem;
            left: 5rem;		    
            width: 60rem;
         }
		   .pad {
            background: linear-gradient(#29C2FF, #3B00FF);
            width: 30%;
            height: 30%;
            padding: 200px;
            border-radius: 2.5rem;
            margin-left: 10%;
            margin-top: 2%;
         }

}
         .wrapper{
            position: relative;
         }
         .form__label{
            position: absolute;
            bottom: 4.2rem;
            left: -2rem;
            color: #3B00FF;
            font-size: 15px;
            transform: translateY(-50%);
            transition: all 0.2s ease;
            pointer-events: none;
            font-family: poppins;
         }
input:focus + label,
input:valid + label{
   bottom: 6.2rem;
   font-size: 12px;
   background: #fff;
   padding-right: 10px;
}
         #whitespace{
            position: relative;
            padding: 7rem;
            background-color: #fff;
            border-radius: 1rem;
            bottom: 14rem;
            right: 25%;
            width: 60rem;
         }
         #next{
            position: relative;
            left: 40%;
            bottom: 2rem;
         }
         #p3{
            position:relative;
            bottom: 3em;
            color: black;
            font-size: 20px;
            left: 38%;
         }
         #p2{
            position:relative;
            bottom: 14em;
            color: #fff;
            left: 15%;

         }
         #initials{
            position: relative;
            width: 110%;
            bottom: 4em;
            right: 3rem;
            border: 2px solid #3B00FF;
            border-radius: 5px;
            padding: 1rem;
         }
         .info{
            font-size: 12px;
            position: relative;
            color: #fff;
            bottom: 18em;
            white-space: nowrap;
            right: 12rem;
         }
         h3{
            position: relative;
            bottom: 9em;
            left: 15%;
            color: #eee
         }
         .container-button{
            position: relative;
            bottom: 15.7em;
         }
         .container-text{
            position: relative;
            bottom: 7em;
            left: 30%;
            color: #eee
         }
         .logo{
            position: relative;
            top: 30px;
            left: 150px;
         }
         #display_image {
            height: 100%;
            width: 100%;
            border: 1px solid black;
            background-position: center;
            background-size:100% 100%;
            display: none;
         }
         #block{
            display: inline-block;
            position: fixed;
           bottom: 0px;
           left: 0px; 
         }
         #parent{
            display: flex;
            justify-content: center;
            align-items: center;
         }
         #result{
            position: fixed;
           bottom: 0px;
           right: 0px; 
         }
         /* #toggle{
            visibility: hidden;
         } */
         #start{
            visibility: hidden;
         }
         #vis{
            visibility: hidden;
         }
         #img-vis{
            visibility: visible;
         }
         .study {
            background-color: #29C2FF;
         }
         #image_input {
            display: none;
         }
         .input {
      border: 1px solid #ccc;
    display: inline-block;
    padding: 6px 12px;
    cursor: pointer;
    background-color: #29C2FF;
         }
         #display {
        display: none;
         }
         .pad {
            background: linear-gradient(#29C2FF, #3B00FF);
            width: 80%;
            height: 30%;
            padding: 250px;
            border-radius: 2.5rem;
            margin-left: 10%;
            margin-top: 2%;
         }
         #screen2{
            display: none;
         }
      </style>
      <script type = "text/javascript" >


//Constants to catch API data
const xdata = [
    ["GazeX"],

];
const ydata = [
    ["GazeY"],
];
const timedata = [
    ["Timestamps"],
];

            //function to call API
         function PlotGaze(GazeData) {

/*
	GazeData.state // 0: valid gaze data; -1 : face tracking lost, 1 : gaze uncalibrated
	GazeData.docX // gaze x in document coordinates
	GazeData.docY // gaze y in document cordinates
	GazeData.time // timestamp
*/

         
             document.getElementById("GazeData").innerHTML = "GazeX: " + GazeData.GazeX + " GazeY: " + GazeData.GazeY;
             document.getElementById("HeadPhoseData").innerHTML = " HeadX: " + GazeData.HeadX + " HeadY: " + GazeData.HeadY + " HeadZ: " + GazeData.HeadZ;
             document.getElementById("HeadRotData").innerHTML = " Yaw: " + GazeData.HeadYaw + " Pitch: " + GazeData.HeadPitch + " Roll: " + GazeData.HeadRoll;
         

         var x = GazeData.docX;
         var y = GazeData.docY;
         
         var gaze = document.getElementById("gaze");
         x -= gaze .clientWidth/2;
         y -= gaze .clientHeight/2;
         

	gaze.style.left = x + "px";
	gaze.style.top = y + "px";

         
         if(GazeData.state != 0)
         {
         	if( gaze.style.display  == 'block')
         	gaze  .style.display = 'none';
         }
         else
         {
         	if( gaze.style.display  == 'none')
         	gaze.style.display = 'block';
            xdata.push([GazeData.docX]);
            ydata.push([GazeData.docY]);
            timedata.push([GazeData.time]);

         }
      

         }
         



         //////set callbacks/////////
   window.addEventListener("load", function() {

         GazeCloudAPI.OnCalibrationComplete =function(){ 
            Record();
           
            setTimeout(() => {
               Stop();
   //   t.style.visibility = "visible";
     s.style.visibility = "visible";
     document.querySelector("#display_image").style.backgroundImage = "";
     alert("Study Completed");
            }, 30000);

          }
         GazeCloudAPI.OnCamDenied =  function(){ console.log('camera  access denied')  }
         GazeCloudAPI.OnError =  function(msg){ console.log('err: ' + msg)  }
         GazeCloudAPI.UseClickRecalibration = true;
      	 GazeCloudAPI.OnResult = PlotGaze; 
          });
     

function Start() {
	GazeCloudAPI.StartEyeTracking();
}

function Record() {
   GazeRecorderAPI.Rec();
}

function Stop() {
	GazeCloudAPI.StopEyeTracking();
   GazeRecorderAPI.StopRec();
   var SesionReplayData = GazeRecorderAPI.GetRecData();
   GazePlayer.PlayResultsData(SesionReplayData );
   
}

function Download() {
   let csvContentX = "data:text/csv;charset=utf-8," 
    + xdata.map(e => e.join(",")).join("\n");

    let csvContentY = "data:text/csv;charset=utf-8," 
    + ydata.map(e => e.join(",")).join("\n");

    let csvContentTime = "data:text/csv;charset=utf-8," 
    + timedata.map(e => e.join(",")).join("\n");


    window.open(encodeURI(csvContentX));
    window.open(encodeURI(csvContentY));
    window.open(encodeURI(csvContentTime));
   }
   
   
   </script>
   </head>
   <body oncontextmenu="return false">


      <div id="display">
        
      <div id="parent">

      
   </div>
         


      <div id="block">
         <div id="img-vis">
            <label class="input">
         <input type="file" id="image_input" name="image_input" accept="image/*">
         Upload Image
      </label>
      </div>
         <div id="start">
         <button type="button" id="record" class="study btn" >Start Study</button>
      </div>
         <!-- <div id="toggle">
         <button type="button" onclick="Download()" class="btn btn-primary">Download</button>
      </div> -->
      </div>
      
      

<div id="vis">
      <div id="result" >
         <p >  
            Real-Time Result:
            <p id = "GazeData" > </p>
            <p id = "HeadPhoseData" > </p>
            <p id = "HeadRotData" > </p>
         </p>
      </div>
   </div>

      <div id ="gaze" style ='position: absolute;display:none;width: 100px;height: 100px;border-radius: 50%;border: solid 2px  rgba(255, 255,255, .2);	box-shadow: 0 0 100px 3px rgba(125, 125,125, .5);	pointer-events: none;	z-index: 999999'></div>
   </div>
   </body>
      
<script>

const image_input = document.querySelector("#image_input");
var uploaded_image = "";

const s = document.getElementById("start");

let img = document.getElementById("img-vis");

let next = document.getElementById("next");

let dis = document.getElementById("terms");

let check1 = document.getElementById("check1");
let check2 = document.getElementById("check2");
let check3 = document.getElementById("check3");
dis.addEventListener("click", function() {
   if((check1 && check2 && check3).checked)
{ 
        
     document.getElementById("screen1").style.display = "none";   
     document.getElementById("screen2").style.display= "inline";

   //   document.getElementById("display").style.display = "inline";
   // document.getElementById("pad").style.display = "none";
}
})


let initials = document.getElementById("initials");

next.addEventListener("click", function() {
   if (initials.value.length > 0) {
        document.getElementById("display").style.display = "inline";
   document.getElementById("pad").style.display = "none";
   document.getElementById("logo").style.display = "none";
   }
})




image_input.addEventListener("click", function () {
s.style.visibility = "visible";
})


image_input.addEventListener("change", function() {
   const reader = new FileReader();
   reader.addEventListener("load", () => {
      uploaded_image = reader.result;
      document.getElementById("display_image").classList.add("w3-animate-opacity")
      document.querySelector("#display_image").style.backgroundImage = `url(${uploaded_image})`;
      document.getElementById("display_image").style.display = "block";

   });
   reader.readAsDataURL(this.files[0]);
})


// let t = document.getElementById("toggle");
let record = document.getElementById("record");

record.addEventListener("click", function() {
s.style.visibility = "hidden";
img.style.visibility = "hidden"; 
Start();

// setTimeout(() => {
//    Record();
// }, 10000);

  
//    setTimeout(() => {
//      Stop();
//      t.style.visibility = "visible";
//      s.style.visibility = "visible";
//      document.querySelector("#display_image").style.backgroundImage = "";
//      alert("Study Completed");
//   }, 130000);

})




</script>

<script>  
   document.onkeypress = function (event) {  
   event = (event || window.event);  
   if (event.keyCode == 123) {  
   return false;  
   }  
   }  
   document.onmousedown = function (event) {  
   event = (event || window.event);  
   if (event.keyCode == 123) {  
   return false;  
   }  
   }  
   document.onkeydown = function (event) {  
   event = (event || window.event);  
   if (event.keyCode == 123) {  
   return false;  
   }  
   }  
   </script>  





</html>
